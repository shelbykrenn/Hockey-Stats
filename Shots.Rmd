---
title: "Shots"
author: "Last update: 10.31.18"
output: html_document
---

```{r, echo = FALSE, warning = FALSE, message = FALSE}
library(readxl)
library(DataComputing)
library(png)
rink.png <- readPNG("Screen Shot 2018-11-03 at 17.40.10.png")
shots <- read_excel("rough.xlsx")
shots2 <- read_excel("rough2.xlsx")
shots$loc_f = factor(shots$loc,
                     levels=c('LL', 'LC', 'LR',
                              'ML', 'MC', 'MR',
                              'HL', 'HC', 'HR'))
shots$type_f = factor(shots$type, 
                      levels = c('ON', 'OFF',
                                 'B', 'G'))
shots$opp_f = factor(shots$opp,
                     levels = c('Colgate', 'Merrimack', 'Union', 
                                'Providence', 'Mercyhurst', 'Syracuse'))
shots2$opp_f = factor(shots2$Opp,
                      levels = c('Colgate', 'Merrimack', 'Union', 
                                'Providence', 'Mercyhurst', 'Syracuse'))
shotcounts <-
  shots %>%
  group_by(game, 
           plr) %>%
  summarise(avg_count = n())

shottypecounts <-
  shots %>%
  group_by(game, 
           type_f) %>%
  summarise(avg_count = n())

typeloc <-
  shots %>%
  group_by(type_f,
           loc_f) %>%
  summarise(avg_count = n())

typeplr <-
  shots %>%
  group_by(type_f,
           plr) %>%
  summarise(avg_count = n())

loc <-
  shots %>%
  group_by(loc_f) %>%
  summarise(avg_count = n())
  loc$total = sum(loc$avg_count)
  loc$perc = loc$avg_count/loc$total

on <-
  typeloc[typeloc$type_f == "ON", 1:3]
  on$total = sum(on$avg_count)
  on$perc = on$avg_count/on$total
  
off <-
  typeloc[typeloc$type_f == "OFF", 1:3]
  off$total = sum(off$avg_count)
  off$perc = off$avg_count/off$total
  
blocked <-
  typeloc[typeloc$type_f == "B", 1:3]
  blocked$total = sum(blocked$avg_count)
  blocked$perc = blocked$avg_count/blocked$total

goals <-
  typeloc[typeloc$type_f == "G", 1:3]
  newrow <- data.frame(type_f = c("G", "G"), 
                       loc_f = c("LL", "MR"),
                       avg_count = as.integer(0, 0))
  goals <- bind_rows(goals, newrow)
  goals$total = sum(goals$avg_count)
  goals$perc = goals$avg_count/goals$total
  
goals$loc = factor(goals$loc_f,
                     levels=c('LL', 'LC', 'LR',
                              'ML', 'MC', 'MR',
                              'HL', 'HC', 'HR'))
```

#Number of Shot Attempts by Player
```{r, echo = FALSE, warning = FALSE, fig.width = 8, fig.height = 7}
ggplot(data = shots, 
       aes(x = reorder(plr,plr))) +
  ylab("Number of Shots") +
  xlab("Player") +
  geom_bar(stat = "count")
```

#Progression on Shots Attempted by Player
```{r, echo = FALSE, warning = FALSE, fig.width =8, fig.height = 7}
ggplot(data = shotcounts, 
       aes(x = game, 
           y = avg_count)) +
  ylab("Number of Shots") +
  xlab("Game Number") +
  geom_point() +
  facet_wrap(~plr, 
             ncol = 6) +
  stat_smooth(method = lm)
```

#FNS of Shots Attempted by Player
```{r, echo = FALSE, warning = FALSE, fig.width = 8, fig.height = 7}
ggplot(data = shotcounts, 
       aes(y = avg_count, 
           x = reorder(plr, plr))) +
  ylab("Number of Shots") +
  xlab("Player") +
  geom_boxplot(aes(group = plr), 
               outlier.color = "red", 
               fill = "lightblue", 
               alpha = 0.5)
```

#Number of Shot Attempts by Game
```{r, echo = FALSE, warning = FALSE, fig.width = 8, fig.height = 7}
ggplot(data = shots, 
       aes(x = game)) +
  ylab("Number of Shots") +
  xlab("Game Number") +
  geom_bar(stat = "count")
```

#Number of Shot Attempts by Opponent
```{r, echo = FALSE, warning = FALSE, fig.width = 8, fig.height = 7}
ggplot(data = shots2, aes(x = game)) +
  ylab("Number of Shot Attempts") +
  xlab("Game Number") +
  labs(colour = "Team") +
  geom_point(aes(y = attagainst)) +
  geom_line(aes(y = attagainst, color = "Opponent")) +
  geom_point(aes(y = attfor)) + 
  geom_line(aes(y = attfor, color = "Penn State"))
```

#Number of Shot attempts by location
```{r, echo = FALSE, warning = FALSE, fig.width = 8, fig.height = 7}
ggplot(data = shots, 
       aes(x = loc_f)) +
  ylab("Number of Shots") +
  xlab("Location") +
  geom_bar(stat = "count")
```

#Shot Attempts by Player AND Location
```{r, fig.width = 8, fig.height = 7, echo = FALSE, warning = FALSE}
ggplot(data = shots, 
       aes(x = type_f, 
           fill = loc)) +
  ylab("Number of Shots") +
  xlab("Type of Shot") +
  geom_bar() +
  facet_wrap(~plr, 
             ncol = 6)
```

#FNS of Shot Type by Game
```{r, echo = FALSE, warning = FALSE, fig.width = 8, fig.height = 7}
ggplot(data = shottypecounts, 
       aes(x = type_f, 
           y = avg_count)) +
  ylab("Number of Attempts") +
  xlab("Shot Type") +
  geom_boxplot(outlier.colour = "red",
               fill = "lightgreen",
               alpha = 0.5)
```

#Frequency of Shot Type by Location
```{r, fig.width = 8, fig.height = 7, echo = FALSE, warning = FALSE}
ggplot(data = shots, 
       aes(x = type_f, 
           fill = type)) +
  ylab("Number of Shots") +
  xlab("Type of Shot") +
  geom_bar(stat = "count") +
  facet_wrap(~loc_f)
```

#Frequency of Shots by Location
##Blocked
```{r, fig.width = 8, fig.height = 7, echo = FALSE, warning = FALSE}
ggplot(data = blocked,
       aes(x = type_f, y = total, fill = perc)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_wrap(~loc_f) +
  theme_void()
```

##On net
```{r, fig.width = 8, fig.height = 7, echo = FALSE, warning = FALSE}
ggplot(data = on,
       aes(x = type_f, y = total, fill = perc)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_wrap(~loc_f) +
  theme_void()
```

##Off net
```{r, fig.width = 8, fig.height = 7, echo = FALSE, warning = FALSE}
ggplot(data = off,
       aes(x = type_f, y = total, fill = perc)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_wrap(~loc_f) +
  theme_void()
```

##Goals
```{r, fig.width = 8, fig.height = 7, echo = FALSE, warning = FALSE}
ggplot(data = goals,
       aes(x = type_f, y = total, fill = perc)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_wrap(~loc) +
  theme_void()
```



